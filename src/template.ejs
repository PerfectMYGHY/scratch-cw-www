<!DOCTYPE html>
<!--[if lt IE 9 ]> 
    <html class="ie8"> 
<![endif]-->
<!--[if IE 9 ]> 
    <html class="ie9"> 
<![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> 
<html> 
<!--<![endif]-->
<head>
    <% if (htmlWebpackPlugin.options.gtm_id) { %>
    <!-- Google Tag Manager -->
    <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl + '<%= htmlWebpackPlugin.options.gtm_env_auth %>';
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', '<%- htmlWebpackPlugin.options.gtm_id %>');
    </script>
    <!-- End Google Tag Manager -->
    <% } %>

    <meta charset="UTF-8" />

    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=<%= htmlWebpackPlugin.options.viewportWidth %>, initial-scale=1">

    <!-- Prevent mobile Safari from making phone numbers -->
    <meta name="format-detection" content="telephone=no">

    <% if (!htmlWebpackPlugin.options.dynamicMetaTags) { %>
    <title>Scratch创世界 - <%= htmlWebpackPlugin.options.title %></title>

    <!-- Search & Open Graph-->
    <meta name="description" content="<%= htmlWebpackPlugin.options.description %>" />
    <meta name="google-site-verification" content="m_3TAXDreGTFyoYnEmU9mcKB4Xtw5mw6yRkuJtXRKxM" />

    <meta property="og:url" content="https://www.scratch-cw.top/" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Scratch创世界 - <%= htmlWebpackPlugin.options.title %>" />
    <meta property="og:description" content="<%= htmlWebpackPlugin.options.description %>" />
    <meta property="og:image" content="<%- htmlWebpackPlugin.options.og_image %>" />
    <meta property="og:image:type" content="<%- htmlWebpackPlugin.options.og_image_type %>" />
    <meta property="og:image:width" content="<%- htmlWebpackPlugin.options.og_image_width %>" />
    <meta property="og:image:height" content="<%- htmlWebpackPlugin.options.og_image_height %>" />
    <% } %>

    <!-- Favicon & CSS normalize -->
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/css/lib/normalize.min.css" />
    <link rel="stylesheet" href="<%= htmlWebpackPlugin.files.chunks.common.css[0] %>" />
    <link rel="stylesheet" href="<%= htmlWebpackPlugin.files.chunks[htmlWebpackPlugin.options.route.name].css[0] %>" />

    <!-- Polyfills -->
    <script src="/js/polyfill.min.js"></script>

    <!-- Styles -->
    <style id="splash-style">
        .block-animation {
            width: 125px;
            height: 150px;
            margin: 50px auto 0px;
        }

            .block-animation img {
                display: block;
                position: relative;
                height: 30%;
                margin-top: -4px;
            }

        .top-block {
            animation: top-slide-in 1.5s ease infinite;
        }

        .middle-block {
            animation: middle-slide-in 1.5s ease infinite;
        }

        .bottom-block {
            animation: bottom-slide-in 1.5s ease infinite;
        }

        @keyframes top-slide-in {
            0% {
                transform: translateY(50px);
                opacity: 0;
            }

            33% {
                transform: translateY(0px);
                opacity: 1;
            }
        }

        @keyframes middle-slide-in {
            0% {
                transform: translateY(50px);
                opacity: 0;
            }

            33% {
                transform: translateY(50px);
                opacity: 0;
            }

            66% {
                transform: translateY(0px);
                opacity: 1;
            }
        }

        @keyframes bottom-slide-in {
            0% {
                transform: translateY(50px);
                opacity: 0;
            }

            66% {
                transform: translateY(50px);
                opacity: 0;
            }

            100% {
                transform: translateY(0px);
                opacity: 1;
            }
        }

        .splash-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

            .splash-screen[hidden] {
                display: none;
            }

            .splash-screen[data-theme="dark"] {
                background-color: #333;
                color: white;
            }

            .splash-screen > * {
                max-width: 80%;
            }

        .splash-spinner:after {
            content: " ";
            display: block;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            border: 6px solid;
            border-color: currentColor transparent currentColor transparent;
            animation: splash-spinner 1.2s linear infinite;
        }

        @keyframes splash-spinner {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .splash-error-title {
            font-weight: bold;
        }

            .splash-error-title a {
                color: inherit;
            }

        .splash-errors {
            font-family: monospace;
        }

        .splash-error-list {
            white-space: pre-wrap;
        }

        .splash-reset {
            color: inherit;
            background: none;
            padding: 0;
            margin: 0;
            border: none;
            text-decoration: underline;
            cursor: pointer;
        }

            .splash-reset:disabled {
                opacity: 0.8;
            }
    </style>
    <!-- 加载cdn中的js -->
    <!--<script defer src="https://unpkg.com/react@16.14.0/umd/react.production.min.js"></script>
    <script defer src="https://unpkg.com/react-dom@16.14.0/umd/react-dom.production.min.js"></script>
    <script defer src="https://unpkg.com/react-modal@3.16.1/dist/react-modal.min.js"></script>
    <script defer src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script defer src="https://unpkg.com/react-redux@5.1.2/dist/react-redux.min.js"></script>
    <script defer src="https://unpkg.com/react-router-dom@5.3.4/umd/react-router-dom.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/react-virtualized/9.22.5/react-virtualized.min.js"></script>
    <script defer src="https://unpkg.com/lodash@4.17.21/lodash.min.js"></script>-->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
</head>

<body>
    <% if (htmlWebpackPlugin.options.gtm_id) { %>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=<%- htmlWebpackPlugin.options.gtm_id %><%= htmlWebpackPlugin.options.gtm_env_auth %>" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <% } %>
    <noscript>
        <p>您的浏览器已禁用Javascript或完全不支持JavaScript。请您转到您的浏览器偏好设置并启用Javascript或升级您的浏览器，以便使用Scratch创世界。</p>
    </noscript>

    <div class="splash-screen spash-waiting-for-js" hidden>
        <!-- <div class="splash-spinner"></div> -->
        <div class="block-animation">
            <img class="top-block"
                 src="/svgs/top-block.svg"
                 draggable="false" />
            <img class="middle-block"
                 src="/svgs/middle-block.svg"
                 draggable="false" />
            <img class="bottom-block"
                 src="/svgs/bottom-block.svg"
                 draggable="false" />
        </div>
        <div class="splash-tip" style="color:white;">正在拼命加载...</div>
        <div class="splash-tip" style="color:white;" id="longtip" hidden>初次加载可能较慢，请稍等...</div>
        <div class="splash-error-title" hidden>发生了一些错误。请向916881890@qq.com报告以下信息。</div>
        <div class="splash-errors" hidden></div>
        <button class="splash-reset" hidden>单击此处重置缓存（可以修复一些错误）</button>
    </div>

    <script>
        (function () {
            'use strict';

            var theme = '';
            var accent = '#ff4c4c';

            try {
                var themeSetting = localStorage.getItem('tw:theme');
            } catch (e) {
                // ignore
            }
            if (themeSetting === 'light') {
                theme = 'light';
            } else if (themeSetting === 'dark') {
                theme = 'dark';
            } else if (themeSetting) {
                try {
                    var parsed = JSON.parse(themeSetting);
                    if (parsed.accent === 'purple') {
                        accent = '#855cd6';
                    } else if (parsed.accent === 'blue') {
                        accent = '#4c97ff';
                    }
                    if (parsed.gui === 'dark' || parsed.gui === 'light') {
                        theme = parsed.gui;
                    }
                } catch (e) {
                    // ignore
                }
            }

            if (!theme) {
                theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }

            var splash = document.querySelector('.spash-waiting-for-js');
            splash.setAttribute('data-theme', theme);
            if (theme !== 'dark') {
                splash.style.backgroundColor = accent;
            }
            splash.hidden = false;

            var splashErrorTitle = document.querySelector('.splash-error-title');
            var splashError = document.querySelector('.splash-errors');
            var splashReset = document.querySelector('.splash-reset');

            var totalErrors = 0;
            window.onerror = function (event, source, line, col, err) {
                if (++totalErrors > 5) return; // dont bother logging more
                splashErrorTitle.hidden = splashError.hidden = splashReset.hidden = false;
                var el = document.createElement('div');
                el.textContent = 'Error (splash) in ' + source + ' (' + line + ':' + col + '): ' + err;
                splashError.appendChild(el);
            };

            splashReset.onclick = function () {
                splashReset.disabled = true;
                function hardRefresh() {
                    var search = location.search.replace(/[?&]nocache=\d+/, '');
                    location.replace(location.pathname + search + (search ? '&' : '?') + 'nocache=' + Math.floor(Math.random() * 100000));
                }
                if ('serviceWorker' in navigator) {
                    setTimeout(hardRefresh, 5000);
                    navigator.serviceWorker.getRegistration("")
                        .then(function (registration) {
                            if (registration) {
                                return registration.unregister();
                            }
                        })
                        .then(hardRefresh)
                        .catch(hardRefresh);
                } else {
                    hardRefresh();
                }
            };

            const timr = setTimeout(() => {
                document.querySelector("#longtip").hidden = false;
            }, 3000);

            window.SplashEnd = () => {
                //splash.hidden = true;
                splash.remove();
                window.onerror = null;
                document.getElementById("splash-style").remove();
                clearTimeout(timr);
            };
        })();
    </script>

    <div id="app"></div>


    <!-- Vendor & Initialize (Session & Localization)-->
    <script defer src="<%= htmlWebpackPlugin.files.chunks.common.entry %>"></script>
    <script defer src="<%= htmlWebpackPlugin.files.chunks.formatjs.entry %>"></script>
    <% if (htmlWebpackPlugin.options.isProject) { %>
    <script defer src="<%= htmlWebpackPlugin.files.chunks.scratch.entry %>"></script>
    <% } %>

    <!-- Scripts -->
    <script defer src="/js/<%= htmlWebpackPlugin.options.route.intlName || htmlWebpackPlugin.options.route.name %>.intl.js"></script>
    <script defer src="<%= htmlWebpackPlugin.files.chunks[htmlWebpackPlugin.options.route.name].entry %>"></script>

    <!-- Translate title element -->
<!--    <% if (!htmlWebpackPlugin.options.dynamicMetaTags) { %>
    <script>
        var loc = window._locale || 'en';
        if (typeof window._messages !== 'undefined' && loc !== 'en') {
            if (typeof window._messages[loc] === 'undefined') {
                loc = loc.split('-')[0];
            }
            if (typeof window._messages[loc] !== 'undefined') {
                var localizedTitle = window._messages[loc]['general.' + '<%= htmlWebpackPlugin.options.title %>'.toLowerCase()] || '';
                if (localizedTitle.length > 0) {
                    document.title = 'Scratch创世界 - ' + localizedTitle;
                }
            }
        }
    </script>
    <% } %>-->
</body>
</html>
